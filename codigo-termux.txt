#!/data/data/com.termux/files/usr/bin/bash

echo "[INFO] Instalando depend칡ncias..."
pkg update -y && pkg upgrade -y
pkg install git gh -y

echo "[INFO] Verificando login no GitHub..."
if ! gh auth status >/dev/null 2>&1; then
  gh auth login
else
  echo "[INFO] J치 autenticado no GitHub."
fi

# Caminho do projeto
PROJETO_BASE="/sdcard/GITHUB"

# Verifica se a pasta existe
if [ ! -d "$PROJETO_BASE" ]; then
  echo "[ERRO] A pasta $PROJETO_BASE n칚o existe!"
  exit 1
fi

cd "$PROJETO_BASE" || exit

# Inicializa git se necess치rio
if [ ! -d ".git" ]; then
  echo "[INFO] Inicializando reposit칩rio Git..."
  git init
  echo "node_modules/" > .gitignore
fi

# Mostra reposit칩rios do usu치rio autenticado
echo ""
echo "[INFO] Seus reposit칩rios no GitHub:"
gh repo list --limit 20
echo ""
read -p "游녤 Digite o nome do reposit칩rio para enviar (ex: usuario/repositorio): " REPO

# Verifica se existe reposit칩rio remoto
if gh repo view "$REPO" >/dev/null 2>&1; then
  echo "[INFO] Reposit칩rio encontrado no GitHub."
else
  echo "[INFO] Reposit칩rio n칚o encontrado. Deseja criar? (s/n)"
  read RESP
  if [ "$RESP" = "s" ]; then
    gh repo create "$REPO" --public
  else
    echo "[ERRO] Reposit칩rio n칚o existe. Encerrando."
    exit 1
  fi
fi

# Adiciona reposit칩rio remoto
git remote remove origin 2>/dev/null
git remote add origin "https://github.com/$REPO.git"

# Comita e envia
git add .
git commit -m "Upload autom치tico via Termux"
git branch -M main

echo "[INFO] Enviando arquivos..."
git push -u origin main

if [ $? -eq 0 ]; then
  echo "[OK] Upload conclu칤do com sucesso no GitHub!"
else
  echo "[ERRO] Falha ao enviar. Verifique conex칚o ou permiss칫es."
fi